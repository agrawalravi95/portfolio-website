var body = document.body,
    html = document.documentElement,
	wrapper = document.getElementsByClassName('wrapper')[0],
	header = document.getElementsByTagName('header')[0],
	introText = document.getElementsByClassName('home__intro-text')[0],
	navMenu = document.getElementsByClassName('nav')[0],
	navLinks = document.getElementsByClassName('nav-link'),
	brand = document.getElementsByClassName('brand')[0],
	onLink = document.getElementsByClassName('on')[0],
	scrollDown = document.getElementsByClassName('home__down-symbol')[0],
	workImages = document.getElementsByClassName('work-project__img'),
	menuIcon = document.getElementsByClassName('nav-toggle')[0],
	loader = document.getElementsByClassName('loader')[0],
	i,
	SCROLL_DURATION = 2500,
	sections = document.getElementsByTagName('section'),
	height = Math.max( body.scrollHeight, body.offsetHeight, 
                       html.clientHeight, html.scrollHeight, html.offsetHeight ),
	width = Math.max( body.scrollWidth, body.offsetWidth, 
                       html.clientWidth, html.scrollWidth, html.offsetWidth ),
	outerWidth = window.outerWidth,
	outerHeight = window.outerHeight,
	currentSection = sections[0],
	prevSection = sections[0];

if (window.outerWidth <= 960) {
	navMenu.className = "nav pr nav-hidden";
};


window.onload = function() {
	Velocity(loader, {opacity:0, delay:3500});
	setTimeout(function(){
		loader.style.display = "none";
	}, 5000);
};
// Disable scroll on mouse and arrow keys

var keys = [37, 38, 39, 40];
var scrollFlag = true;

function preventDefault(e) {
  e = e || window.event;
  if (e.preventDefault)
      e.preventDefault();
  e.returnValue = false;  
}

function keydown(e) {
    for (var i = keys.length; i--;) {
        if (e.keyCode === keys[i]) {
            preventDefault(e);
            return;
        }
    }
}

function wheel(e) {
  preventDefault(e);
}

function disable_scroll() {
  if (window.addEventListener) {
      window.addEventListener('DOMMouseScroll', wheel, false);
  }
  window.onmousewheel = document.onmousewheel = window.ontouchmove = document.ontouchmove = wheel;
  document.onkeydown = keydown;
  /*wrapper.classList.add("non-scrollable");
  body.classList.add("non-scrollable");*/

}

function enable_scroll() {

    if (window.removeEventListener) {
        window.removeEventListener('DOMMouseScroll', wheel, false);
    }
    window.onmousewheel = document.onmousewheel = document.onkeydown = window.ontouchmove = document.ontouchmove = null; 
    body.classList.remove("non-scrollable");
    wrapper.classList.remove("non-scrollable");

}

// On resize event 

window.onresize = function() {

	width = Math.max( body.scrollWidth, body.offsetWidth, 
                       html.clientWidth, html.scrollWidth, html.offsetWidth );

	if (width <= 960 && navMenu.className=="nav pr") {
		navMenu.className = "nav pr nav-hidden";
		menuIcon.classList.remove("active");
		enable_scroll();
	}
}


//Menu Icon 

menuIcon.addEventListener("click", function(e) {	
	this.classList.toggle( "active" );
	navMenu.classList.toggle("nav-hidden");
	if (scrollFlag == true) {
		disable_scroll();
		scrollFlag = false;
	}
	else
	{
		enable_scroll();
		scrollFlag = true;
	}
	e.preventDefault();
}, false);

var closeMenu = function() {

	menuIcon.classList.remove( "active" );
	navMenu.classList.add("nav-hidden");
};


//Navlinks Event Handlers

navLinks[0].addEventListener("click", function(e) {
	if(width<960) closeMenu();
	Velocity(sections[0], "scroll", { duration: 1000 });
}, false);
navLinks[1].addEventListener("click", function(e) {
	if(width<960) closeMenu();
	Velocity(sections[1], "scroll", { duration: 1000 });
}, false);
navLinks[2].addEventListener("click", function(e) {
	if(width<960) closeMenu();
	Velocity(sections[2], "scroll", { duration: 1000 });
}, false);
navLinks[3].addEventListener("click", function(e) {
	if(width<960) closeMenu();
	Velocity(sections[3], "scroll", { duration: 1000 });
}, false);
scrollDown.addEventListener("click", function(e) {
	Velocity(sections[1], "scroll", { duration: 1000 });
}, false);


// Show and hide Brand on Mobile


var brandHandler = function(newSection) {

	currentSection = newSection;
	if (prevSection != currentSection) {
		brand.classList.remove("hidden");
		setTimeout(function () {
			brand.classList.add("hidden");
		}, 1000);
		prevSection = currentSection;

	}
	else
		return;
	
}

var showBrand = function() {
	brand.classList.remove("hidden");
}

window.onscroll = function addOrRemoveBackground() {

	//Height Update
	height = Math.max( body.scrollHeight, body.offsetHeight, 
                       html.clientHeight, html.scrollHeight, html.offsetHeight );

	//Header Scroll
	if(window.scrollY >= sections[1].offsetTop-100 && width > 960)
	{
		header.classList.add("header--white");
	}
	else
	{
		header.classList.remove("header--white");
	}

	//Scroll Spy
	if(window.scrollY + window.innerHeight + 100 >= window.height)
	{
		onLink.className = "nav-link";
		navLinks[3].className = "nav-link on";
		onLink = navLinks[3];

		if (width <= 960) {
			brand.innerHTML = "Contact";
			brandHandler(sections[3]);			
		};
				
	}	
	else if(window.scrollY >= sections[2].offsetTop-100)
	{

		onLink.className = "nav-link";
		navLinks[2].className = "nav-link on";
		onLink = navLinks[2];

		if (width <= 960) {
			brand.innerHTML = "About";
			brandHandler(sections[2]);	
		};
	}
	else if(window.scrollY >= sections[1].offsetTop-100)
	{
		onLink.className = "nav-link";
		navLinks[1].className = "nav-link on";
		onLink = navLinks[1];

		if (width <= 960) {
			brand.classList.add("brand--scrolled");
			brand.innerHTML = "Work";
			brandHandler(sections[1]);
		};
	}
	else {
		onLink.className = "nav-link";
		navLinks[0].className = "nav-link on";
		onLink = navLinks[0];

		for (var i = 0; i < workImages.length; i++) {
			workImages[i].children[0].className = "";
		};

		if (width <= 960) {
			brand.classList.remove("brand--scrolled");
			brand.innerHTML = "Home";
			brandHandler(sections[0]);		
		};
	}
};

// Canvas

(function() {

	if(window.innerWidth <= 960)
		return;

    var width, Cheight, largeHeader, canvas, ctx, circles, target, animateHeader = true;

    // Main
    initHeader();
    addListeners();

    function initHeader() {
        width = window.innerWidth;
        Cheight = window.innerHeight;
        target = {x: 0, y: Cheight};

        largeHeader = document.getElementById('large-header');
        largeHeader.style.height = Cheight+'px';

        canvas = document.getElementById('demo-canvas');
        canvas.width = width;
        canvas.height = Cheight;
        ctx = canvas.getContext('2d');

        // create particles
        circles = [];
        for(var x = 0; x < width*0.5; x++) {
            var c = new Circle();
            circles.push(c);
        }
        animate();
    }

    // Event handling
    function addListeners() {
        window.addEventListener('scroll', scrollCheck);
        window.addEventListener('resize', resize);
    }

    function scrollCheck() {
        if(document.body.scrollTop > Cheight) animateHeader = false;
        else animateHeader = true;
    }

    function resize() {
        width = window.innerWidth;
        Cheight = window.innerHeight;
        largeHeader.style.height = Cheight+'px';
        canvas.width = width;
        canvas.height = Cheight;
    }

    function animate() {
        if(animateHeader) {
            ctx.clearRect(0,0,width,height);
            for(var i in circles) {
                circles[i].draw();
            }
        }
        requestAnimationFrame(animate);
    }

    // Canvas manipulation
    function Circle() {
        var _this = this;

        // constructor
        (function() {
            _this.pos = {};
            init();
        })();

        function init() {
            _this.pos.x = Math.random()*width;
            _this.pos.y = Cheight+Math.random()*100;
            _this.alpha = 0.1+Math.random()*0.3;
            _this.scale = 0.1+Math.random()*0.3;
            _this.velocity = Math.random();
        }

        this.draw = function() {
            if(_this.alpha <= 0) {
                init();
            }
            _this.pos.y -= _this.velocity;
            _this.alpha -= 0.0005;
            ctx.beginPath();
            ctx.arc(_this.pos.x, _this.pos.y, _this.scale*10, 0, 2 * Math.PI, false);
            ctx.fillStyle = 'rgba(255,255,255,'+ _this.alpha+')';
            ctx.fill();
        };
    }

})();



var _gaq=[['_setAccount','UA-59051500-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));